var App = Ember.Application.create({
	LOG_TRANSITIONS: true
});

App.ApplicationAdapter = DS.RESTAdapter.extend();

App.ApplicationAdapter = DS.FixtureAdapter.extend();

App.Product = DS.Model.extend({
	title: DS.attr("string"),
	price: DS.attr("number"),
	description: DS.attr("string"),
	isOnSale: DS.attr("boolean"),
	image: DS.attr("string"),
	reviews: DS.hasMany("review", {async: true}),
});

App.Review = DS.Model.extend({
	text: DS.attr("string"),
	reviewedAt: DS.attr("date"),
	product: DS.belongsTo("product"),
});

App.Router.map(function() {
  this.route("about");
  this.route("credits");
  this.resource("products", function() {
  	this.resource("product", { path: "/:product_id" });
  	this.route("onsale")
  });
});

App.Router.reopen({
  // location: 'none'
});

App.IndexController = Ember.ArrayController.extend({
	productsCount: Ember.computed.alias("length"),

	onSale: function() {
		return this.filterProperty("isOnSale", true).slice(0,3);
	}.property("@each.isOnSale"),
});

App.ProductsController = Ember.ArrayController.extend({
  sortProperties: ["title"],
});


/* App.ProductRoute = Ember.Route.extend({
  // activate: function() {},
  // deactivate: function() {},
  // setupController: function(controller, model) {},
  // renderTemplate: function() {},
  // beforeModel: function() {},
  // afterModel: function() {},
  
  model: function(params) {
  	return this.store.find("product", params.product_id)
  }
}); */


App.ProductsRoute = Ember.Route.extend({
  // activate: function() {},
  // deactivate: function() {},
  // setupController: function(controller, model) {},
  // renderTemplate: function() {},
  // beforeModel: function() {},
  // afterModel: function() {},
  
  model: function() {
      return this.store.findAll("product", { order: "title" });
  }
});

App.ProductsOnsaleRoute = Ember.Route.extend({
  // activate: function() {},
  // deactivate: function() {},
  // setupController: function(controller, model) {},
  // renderTemplate: function() {},
  // beforeModel: function() {},
  // afterModel: function() {},
  
  model: function() {
  	return this.modelFor("products").filterBy("isOnSale");
  }
});


App.IndexRoute = Ember.Route.extend({
  // activate: function() {},
  // deactivate: function() {},
  // setupController: function(controller, model) {},
  // renderTemplate: function() {},
  // beforeModel: function() {},
  // afterModel: function() {},
  
  model: function() {
      return this.store.findAll("product");
  }
});



/* App.PRODUCTS = [
/*	{
		title: "Flint",
		price: 99,
		description: "The Flintstones is an animated, prime-time American television sitcom that was broadcast from September 30, 1960, to April 1, 1966, on ABC. The show was produced by Hanna-Barbera. The Flintstones was about a working-class Stone Age man's life with his family and his next-door neighbor and best friend.",
		isOnSale: true,
		image: "http://goodfilmguide.co.uk/wp-content/uploads/2011/05/Flinstones.jpg",
	},
	{
		title: "Kindling",
		price: 249,
		description: "Kindling is enjoyable software used by teams to discuss ideas, solve problems, and pursue opportunities.",
		isOnSale: false,
		image: "http://aweebitirish.com/wp-content/uploads/2014/03/kindling-wood.png",
	},
*/
/* ]; */

App.Product.FIXTURES = [
	{
		id: 1,
		title: "Flint",
		price: 99,
		description: "The Flintstones is an animated, prime-time American television sitcom that was broadcast from September 30, 1960, to April 1, 1966, on ABC. The show was produced by Hanna-Barbera. The Flintstones was about a working-class Stone Age man's life with his family and his next-door neighbor and best friend.",
		isOnSale: true,
		image: "http://goodfilmguide.co.uk/wp-content/uploads/2011/05/Flinstones.jpg",
		reviews: [100, 101],
	},
	{
		id: 2,
		title: "Kindling",
		price: 249,
		description: "Kindling is enjoyable software used by teams to discuss ideas, solve problems, and pursue opportunities.",
		isOnSale: false,
		image: "http://aweebitirish.com/wp-content/uploads/2014/03/kindling-wood.png",
	},
	{
	  id: 3,
	  title: 'Matches',
	  price: 499,
	  description: 'One end is coated with a material that can be ignited by frictional heat generated by striking the match against a suitable surface.',
	  isOnSale: true,
	  isSeasonal: true,
	  ratings: [104],
	  image: 'assets/img/matches.png',
	  imageCredit: ''
	},
	{
	  id: 4,
	  title: 'Bow Drill',
	  price: 999,
	  description: 'The bow drill is an ancient tool. While it was usually used to make fire, it was also used for primitive woodworking and dentistry.',
	  isOnSale: false,
	  isSeasonal: false,
	  ratings: [],
	  image: 'assets/img/bow-drill.png',
	  imageCredit: ''
	},
	{
	  id: 5,
	  title: 'Tinder',
	  price: 499,
	  description: 'Tinder is easily combustible material used to ignite fires by rudimentary methods.',
	  isOnSale: true,
	  isSeasonal: false,
	  ratings: [],
	  image: 'assets/img/tinder.png',
	  imageCredit: ''
	},
	{
	  id: 6,
	  title: 'Birch Bark Shaving',
	  price: 999,
	  description: 'Fresh and easily combustable',
	  isOnSale: true,
	  isSeasonal: false,
	  ratings: [],
	  image: 'assets/img/birch.png',
	  imageCredit: ''
	}
];

App.Review.FIXTURES = [
	{
		id: 100,
		product: 1,
		text: "Started a fire in no time!",
	},
	{
		id: 101,
		product: 1,
		text: "Not the brightest flame, but warm",
	},
]